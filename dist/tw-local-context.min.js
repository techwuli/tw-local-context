!function(){"use strict";angular.module("tw.local.context",[]).provider("twLocalContext",["$windowProvider",function(t){var e=this;e.prefix="twlc",e.storageType="localStorage",e.autoGenerateKey=!0,e.setPrefix=function(t){return this.prefix=t,this},e.setStorageType=function(t){return this.storageType=t,this},e.setAutoGenerateKey=function(t){return this.autoGenerateKey=t,this};var r=function(){var r=t.$get();switch(e.storageType){case"localStorage":return r.localStorage;case"sessionStorage":return r.sessionStorage;default:throw'Storage type: "'+e.storageType+'" not supported'}},i=function(){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";return t.replace(/[xy]/g,function(t){var e=16*Math.random()|0,r="x"===t?e:3&e|8;return r.toString(16)})},a=function(t,e){this.data=[],this.name=t,this.key=e,this.addOrUpdate=function(t){if(t){Array.isArray(t)||(t=[t]);for(var e=0;e<t.length;e++){if(!t[e][this.key]){if(!this.autoGenerateKey)throw console.error("item key not set: "),console.error(t[e]),"item key not set";t[e][this.key]=i()}if(0!==this.data.length){for(var r=!1,a=0;a<this.data.length;a++)if(t[e][this.key]==this.data[a][this.key]){this.data[a]=t[e],r=!0;break}r||this.data.push(t[e])}else this.data.push(t[e])}}},this.load=function(){var t=r().getItem(this.name);if(t){var e=JSON.parse(t);if(Array.isArray(e))return void(this.data=e)}this.data=[]},this.getByKey=function(t){if(0===this.data.length)return null;for(var e=0;e<this.data.length;e++)if(this.data[e][this.key]==t)return this.data[e]},this.removeByKey=function(t){if(0!==this.data.length)for(var e=0;e<this.data.length;e++)if(this.data[e][this.key]==t)return void this.data.splice(e,1)},this.removeAll=function(){this.data=[],r().removeItem(this.name)},this.saveChanges=function(){var t=JSON.stringify(this.data);r().setItem(this.name,t)},this.load()},n=function(t){if(!t)throw console.error("name can not be null."),"argument null exception";return e.prefix+"_"+t};e.$get=function(){return{getList:function(t,e){return e=e||"id",t=n(t),new a(t,e)},get:function(t){t=n(t);var e=r().getItem(t);return JSON.parse(e)},set:function(t,e){t=n(t),r().setItem(t,JSON.stringify(e))},clear:function(){var t=r(),i=t.length;if(0!==i){for(var a=[],n=0;n<i;n++)0===t.key(n).indexOf(e.prefix+"_")&&a.push(t.key(n));if(a.length>0)for(var s=0;s<a.length;s++)r().removeItem(a[s])}}}}}])}();