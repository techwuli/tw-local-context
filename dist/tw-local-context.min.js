!function(){"use strict";angular.module("tw.local.context",[]).provider("twLocalContext",["$windowProvider",function(t){var e=this;e.prefix="twlc",e.storageType="localStorage",e.autoGenerateKey=!0,e.setPrefix=function(t){return this.prefix=t,this},e.setStorageType=function(t){return this.storageType=t,this},e.setAutoGenerateKey=function(t){return this.autoGenerateKey=t,this};var r=function(){var r=t.$get();switch(e.storageType){case"localStorage":return r.localStorage;case"sessionStorage":return r.sessionStorage;default:throw'Storage type: "'+e.storageType+'" not supported'}},a=function(){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";return t.replace(/[xy]/g,function(t){var e=16*Math.random()|0,r="x"===t?e:3&e|8;return r.toString(16)})},i=function(t,e){this.data=[],this.name=t,this.key=e,this.addOrUpdate=function(t){if(t){Array.isArray(t)||(t=[t]);for(var e=0;e<t.length;e++){if(!t[e][this.key]){if(!this.autoGenerateKey)throw console.error("item key not set: "),console.error(t[e]),"item key not set";t[e][this.key]=a()}if(0!==this.data.length){for(var r=!1,i=0;i<this.data.length;i++)if(t[e][this.key]==this.data[i][this.key]){this.data[i]=t[e],r=!0;break}r||this.data.push(t[e])}else this.data.push(t[e])}}},this.load=function(){var t=r().getItem(this.name);if(t){var e=JSON.parse(t);if(Array.isArray(e))return void(this.data=e)}this.data=[]},this.getByKey=function(t){if(0===this.data.length)return null;for(var e=0;e<this.data.length;e++)if(this.data[e][this.key]==t)return this.data[e]},this.removeByKey=function(t){if(0!==this.data.length)for(var e=0;e<this.data.length;e++)if(this.data[e][this.key]==t)return void this.data.splice(e,1)},this.removeAll=function(){this.data=[],r().removeItem(this.name)},this.saveChanges=function(){var t=JSON.stringify(this.data);r().setItem(this.name,t)},this.load()};e.$get=function(){return{create:function(t,r){return t||console.error("local context name must be set."),r=r||"id",t=e.prefix+"_"+t,new i(t,r)},removeAll:function(){var t=r(),a=t.length;if(0!==a)for(var i=0;i<a;i++)0===t.key(i).indexOf(e.prefix+"_")&&t.removeItem(t.key(i))}}}}])}();